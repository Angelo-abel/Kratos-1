from __future__ import print_function, absolute_import, division
import KratosMultiphysics
import KratosMultiphysics.IgaApplication as KratosIGA
import KratosMultiphysics.KratosUnittest as KratosUnittest

class TestTriangulation(KratosUnittest.TestCase):
    def test_basic_triangulation(self):

        
        model = KratosMultiphysics.Model()
        iga_model_part =  model.CreateModelPart("IgaModelPart")

        

        with open("geometry.json",'r') as geometry_file:
            iga_geometry_parameters = KratosMultiphysics.Parameters( geometry_file.read())

        iga_geometry_reader = KratosIGA.BrepJsonIO()

        embedded_iga_modeler = KratosIGA.EmbeddedIgaModeler(iga_model_part)
        embedded_iga_modeler.ImportGeometry(iga_geometry_reader, iga_geometry_parameters)
        
        reference_results = [[1.25, 0.5], [1.2489887271532196, 0.5224636094744262], [1.2489887271532196, 0.522463609474426], [1.2458263421041436, 0.5454907631030361], [1.2403497395467578, 0.5687895537113423], [1.2458263421041438, 0.5454907631030362], [1.2489887271532196, 0.5224636094744262], [1.2458263421041436, 0.5454907631030361], [1.2458263421041438, 0.5454907631030362], [1.2324470752656076, 0.5920236773904681], [1.222071001707438, 0.6148236482640008], [1.2324470752656074, 0.5920236773904684], [1.2092488778046628, 0.6368024383462856], [1.1940882968937108, 0.6575745315998076], [1.2092488778046628, 0.6368024383462856], [1.222071001707438, 0.6148236482640008], [1.2092488778046628, 0.6368024383462856], [1.2092488778046628, 0.6368024383462856], [1.2403497395467578, 0.5687895537113423], [1.2324470752656076, 0.5920236773904681], [1.240349739546758, 0.5687895537113424], [1.176776695296637, 0.676776695296637], [1.1575745315998076, 0.6940882968937108], [1.1575745315998076, 0.6940882968937108], [1.1368024383462858, 0.7092488778046628], [1.1148236482640008, 0.7220710017074382], [1.1368024383462856, 0.7092488778046628], [1.1575745315998076, 0.6940882968937108], [1.1368024383462858, 0.7092488778046628], [1.1368024383462856, 0.7092488778046628], [1.0920236773904684, 0.7324470752656076], [1.0687895537113423, 0.7403497395467579], [1.0687895537113423, 0.7403497395467579], [1.0454907631030361, 0.7458263421041436], [1.0224636094744262, 0.7489887271532196], [1.0454907631030363, 0.7458263421041437], [1.0687895537113423, 0.7403497395467579],[1.0454907631030361, 0.7458263421041436], [1.0454907631030363, 0.7458263421041437], [1.1148236482640008, 0.7220710017074382], [1.0920236773904684, 0.7324470752656076], [1.0920236773904684, 0.7324470752656076], [1.1940882968937108, 0.6575745315998076], [1.176776695296637, 0.676776695296637], [1.1940882968937105, 0.6575745315998076], [1.0, 0.75], [0.9775363905255738, 0.7489887271532196], [0.977536390525574, 0.7489887271532197], [0.9545092368969638, 0.7458263421041434], [0.9312104462886578, 0.740349739546758], [0.9545092368969637, 0.7458263421041437], [0.9775363905255738, 0.7489887271532196], [0.9545092368969638, 0.7458263421041434], [0.9545092368969637, 0.7458263421041437], [0.9079763226095319, 0.7324470752656076], [0.8851763517359993, 0.7220710017074383], [0.9079763226095316, 0.7324470752656075], [0.8631975616537144, 0.7092488778046628], [0.8424254684001924, 0.6940882968937108], [0.8631975616537144, 0.7092488778046628], [0.8851763517359993, 0.7220710017074383], [0.8631975616537144, 0.7092488778046628], [0.8631975616537144, 0.7092488778046628], [0.9312104462886578, 0.740349739546758], [0.9079763226095319, 0.7324470752656076], [0.9312104462886578, 0.740349739546758], [0.823223304703363, 0.676776695296637], [0.8059117031062892, 0.6575745315998076], [0.8059117031062892, 0.6575745315998076], [0.7907511221953372, 0.6368024383462856], [0.7779289982925619, 0.6148236482640009], [0.7779289982925619, 0.6148236482640009], [0.8059117031062892, 0.6575745315998076], [0.7907511221953372, 0.6368024383462856], [0.7907511221953372, 0.6368024383462856], [0.7675529247343924, 0.5920236773904682], [0.759650260453242, 0.5687895537113421], [0.759650260453242, 0.5687895537113421], [0.7541736578958566, 0.5454907631030363], [0.7510112728467803, 0.5224636094744262], [0.7510112728467803, 0.5224636094744262], [0.759650260453242, 0.5687895537113421], [0.7541736578958566, 0.5454907631030363], [0.7541736578958566, 0.5454907631030363], [0.7779289982925619, 0.6148236482640009], [0.7675529247343924, 0.5920236773904682], [0.7675529247343924, 0.5920236773904682], [0.8424254684001924, 0.6940882968937108], [0.823223304703363, 0.676776695296637], [0.8424254684001922, 0.6940882968937107], [1.0224636094744262, 0.7489887271532196], [1.0, 0.75], [1.022463609474426, 0.7489887271532196],[1.25, 0.5], [1.25, 0.5], [1.2489887271532196, 0.522463609474426], [1.2458263421041438, 0.5454907631030362], [1.2403497395467578, 0.5687895537113423], [1.240349739546758, 0.5687895537113424], [1.2489887271532196, 0.5224636094744262], [1.2458263421041438, 0.5454907631030362], [1.2489887271532196, 0.522463609474426], [1.2324470752656074, 0.5920236773904684], [1.222071001707438, 0.6148236482640008], [1.2220710017074385, 0.614823648264001], [1.2092488778046628, 0.6368024383462856], [1.1940882968937108, 0.6575745315998076], [1.1940882968937105, 0.6575745315998076], [1.222071001707438, 0.6148236482640008], [1.2092488778046628, 0.6368024383462856], [1.2220710017074385, 0.614823648264001], [1.2324470752656076, 0.5920236773904681], [1.2324470752656074, 0.5920236773904684], [1.240349739546758, 0.5687895537113424], [1.176776695296637, 0.676776695296637], [1.176776695296637, 0.676776695296637], [1.1575745315998076, 0.6940882968937108], [1.1368024383462856, 0.7092488778046628], [1.1148236482640008, 0.7220710017074382], [1.1148236482640008, 0.7220710017074382], [1.1575745315998076, 0.6940882968937108], [1.1368024383462856, 0.7092488778046628], [1.1575745315998076, 0.6940882968937108], [1.0920236773904684, 0.7324470752656076], [1.0920236773904684, 0.7324470752656076], [1.0687895537113423, 0.7403497395467579], [1.0454907631030363, 0.7458263421041437], [1.0224636094744262, 0.7489887271532196], [1.022463609474426, 0.7489887271532196], [1.0687895537113423, 0.7403497395467579], [1.0454907631030363, 0.7458263421041437], [1.0687895537113423, 0.7403497395467579], [1.1148236482640008, 0.7220710017074382], [1.0920236773904684, 0.7324470752656076], [1.1148236482640008, 0.7220710017074382], [1.176776695296637, 0.676776695296637], [1.176776695296637, 0.676776695296637], [1.1940882968937105, 0.6575745315998076], [1.0, 0.75], [1.0, 0.75], [0.977536390525574, 0.7489887271532197], [0.9545092368969637, 0.7458263421041437], [0.9312104462886578, 0.740349739546758], [0.9312104462886578, 0.740349739546758], [0.9775363905255738, 0.7489887271532196], [0.9545092368969637, 0.7458263421041437],[0.977536390525574, 0.7489887271532197], [0.8851763517359993, 0.7220710017074383], [0.8851763517359993, 0.7220710017074383], [0.9079763226095316, 0.7324470752656075], [0.9079763226095316, 0.7324470752656075], [0.9312104462886578, 0.740349739546758], [0.9079763226095319, 0.7324470752656076], [0.8851763517359993, 0.7220710017074383], [0.8851763517359993, 0.7220710017074383], [0.8631975616537144, 0.7092488778046628], [0.8424254684001922, 0.6940882968937107], [0.8631975616537144, 0.7092488778046628], [0.8424254684001924, 0.6940882968937108], [1.022463609474426, 0.7489887271532196], [1.0, 0.75], [1.0, 0.75], [0.8424254684001922, 0.6940882968937107], [0.823223304703363, 0.676776695296637], [0.823223304703363, 0.676776695296637], [0.8059117031062892, 0.6575745315998076], [0.8059117031062892, 0.6575745315998076], [0.7907511221953372, 0.6368024383462856], [0.823223304703363, 0.676776695296637], [0.8059117031062892, 0.6575745315998076], [0.823223304703363, 0.676776695296637], [0.7779289982925619, 0.6148236482640009], [0.7779289982925619, 0.6148236482640009], [0.7675529247343924, 0.5920236773904682], [0.759650260453242, 0.5687895537113421], [0.759650260453242, 0.5687895537113421], [0.7541736578958566, 0.5454907631030363], [0.7541736578958566, 0.5454907631030363], [0.7541736578958566, 0.5454907631030363], [0.7510112728467803, 0.5224636094744262], [0.7675529247343924, 0.5920236773904682], [0.759650260453242, 0.5687895537113421], [0.7675529247343924, 0.5920236773904682], [0.7907511221953372, 0.6368024383462856], [0.7779289982925619, 0.6148236482640009], [0.7907511221953372, 0.6368024383462856], [0.75,0.5], [0.75, 0.5], [0.7510112728467803, 0.5224636094744262], [0.7510112728467803, 0.5224636094744262], [0.75, 0.5], [0.7510112728467803, 0.5224636094744262], [0.7510112728467803, 0.4775363905255738], [0.7541736578958566, 0.4545092368969639], [0.7541736578958566, 0.4545092368969639], [0.7596502604532421, 0.4312104462886577], [0.7675529247343925, 0.4079763226095318], [0.7675529247343925, 0.4079763226095318], [0.7541736578958566, 0.4545092368969639], [0.7596502604532421, 0.4312104462886577], [0.7596502604532421, 0.4312104462886577], [0.7779289982925619, 0.38517635173599923], [0.790751122195337, 0.3631975616537145], [0.790751122195337, 0.3631975616537145], [0.8059117031062891, 0.3424254684001924], [0.8232233047033632, 0.3232233047033632], [0.8232233047033632, 0.3232233047033632], [0.790751122195337, 0.3631975616537145], [0.8059117031062891, 0.3424254684001924], [0.8059117031062891, 0.3424254684001924], [0.7675529247343925, 0.4079763226095318], [0.7779289982925619, 0.38517635173599923], [0.7779289982925619, 0.38517635173599923], [0.8424254684001924, 0.3059117031062893], [0.8631975616537144, 0.29075112219533716], [0.8424254684001924, 0.3059117031062891], [0.8851763517359992, 0.27792899829256185], [0.9079763226095316, 0.26755292473439246], [0.9079763226095316, 0.26755292473439246], [0.8631975616537144, 0.29075112219533716], [0.8851763517359992, 0.27792899829256185], [0.8851763517359992, 0.27792899829256185],[0.9312104462886577, 0.25965026045324213], [0.9545092368969639, 0.25417365789585644], [0.9545092368969639, 0.25417365789585644], [0.9775363905255738, 0.2510112728467803], [1.0, 0.25], [1.0,0.25], [0.9545092368969639, 0.25417365789585644], [0.9775363905255738, 0.2510112728467803], [0.9775363905255738, 0.2510112728467803], [0.9079763226095316, 0.26755292473439246], [0.9312104462886577, 0.25965026045324213], [0.9312104462886577, 0.25965026045324213], [0.8232233047033632, 0.3232233047033632], [0.8424254684001924, 0.3059117031062893], [0.8232233047033632, 0.3232233047033632], [1.0224636094744262, 0.2510112728467803], [1.0454907631030363, 0.25417365789585644], [1.0454907631030363, 0.25417365789585644], [1.0687895537113423, 0.2596502604532421], [1.0920236773904681, 0.26755292473439246], [1.0920236773904681, 0.26755292473439246], [1.0454907631030363, 0.25417365789585644], [1.0687895537113423, 0.2596502604532421], [1.0687895537113423, 0.2596502604532421], [1.114823648264001, 0.27792899829256185], [1.1368024383462858, 0.29075112219533716], [1.1368024383462858, 0.29075112219533716], [1.1575745315998076, 0.30591170310628923], [1.176776695296637, 0.32322330470336313], [1.176776695296637, 0.32322330470336313], [1.1368024383462858, 0.29075112219533716], [1.1575745315998076, 0.30591170310628923], [1.1575745315998076, 0.30591170310628923], [1.0920236773904681, 0.26755292473439246], [1.114823648264001, 0.27792899829256185], [1.114823648264001, 0.27792899829256185], [1.1940882968937108, 0.3424254684001923], [1.209248877804663, 0.36319756165371464], [1.209248877804663, 0.36319756165371464], [1.2220710017074383, 0.3851763517359991], [1.2324470752656076, 0.4079763226095317], [1.2324470752656076, 0.4079763226095317], [1.209248877804663, 0.36319756165371464], [1.2220710017074383, 0.3851763517359991], [1.2220710017074383, 0.3851763517359991], [1.2403497395467578, 0.4312104462886577], [1.2458263421041438, 0.4545092368969638], [1.2458263421041438, 0.4545092368969638], [1.2489887271532196, 0.4775363905255739], [1.25, 0.5], [1.25, 0.5], [1.2458263421041438, 0.4545092368969638], [1.2489887271532196, 0.4775363905255739], [1.2489887271532196, 0.4775363905255739], [1.2324470752656076, 0.4079763226095317], [1.2403497395467578, 0.4312104462886577], [1.2403497395467578, 0.4312104462886577], [1.176776695296637, 0.32322330470336313], [1.1940882968937108, 0.3424254684001923], [1.1940882968937108, 0.3424254684001923], [1.0, 0.25], [1.0224636094744262, 0.2510112728467803], [1.0224636094744262, 0.2510112728467803], [0.7510112728467803, 0.4775363905255738], [0.75, 0.5], [0.7510112728467803, 0.4775363905255738], [0.7596502604532421, 0.4312104462886577], [0.7541736578958566, 0.4545092368969639], [0.7541736578958566, 0.4545092368969639], [0.7510112728467803, 0.4775363905255738], [0.7510112728467803, 0.4775363905255738], [0.7541736578958566, 0.4545092368969639], [0.7779289982925619, 0.38517635173599923], [0.7675529247343925, 0.4079763226095318], [0.7675529247343925, 0.4079763226095318], [0.8059117031062891, 0.3424254684001924], [0.790751122195337, 0.3631975616537145], [0.790751122195337, 0.3631975616537145], [0.7779289982925619, 0.38517635173599923], [0.7779289982925619, 0.38517635173599923], [0.790751122195337, 0.3631975616537145], [0.7596502604532421, 0.4312104462886577], [0.7596502604532421, 0.4312104462886577], [0.7675529247343925, 0.4079763226095318], [0.8424254684001924, 0.3059117031062891], [0.8232233047033632, 0.3232233047033632], [0.8424254684001924, 0.3059117031062893], [0.8851763517359992, 0.27792899829256185], [0.8631975616537144, 0.29075112219533716], [0.8631975616537144, 0.29075112219533716], [0.8424254684001924, 0.3059117031062891], [0.8631975616537144, 0.29075112219533716], [0.8631975616537144, 0.29075112219533716], [0.9312104462886577, 0.25965026045324213], [0.9079763226095316, 0.26755292473439246], [0.9079763226095316, 0.26755292473439246], [0.9775363905255738, 0.2510112728467803], [0.9545092368969639, 0.25417365789585644], [0.9545092368969639, 0.25417365789585644], [0.9312104462886577, 0.25965026045324213], [0.9312104462886577, 0.25965026045324213], [0.9545092368969639, 0.25417365789585644], [0.8851763517359992, 0.27792899829256185], [0.8851763517359992, 0.27792899829256185], [0.9079763226095316, 0.26755292473439246], [0.8059117031062891, 0.3424254684001924], [0.8059117031062891, 0.3424254684001924], [0.8232233047033632, 0.3232233047033632], [1.0224636094744262, 0.2510112728467803], [1.0, 0.25], [1.0, 0.25],[1.0687895537113423, 0.2596502604532421], [1.0454907631030363, 0.25417365789585644], [1.0454907631030363, 0.25417365789585644], [1.0224636094744262, 0.2510112728467803], [1.0224636094744262, 0.2510112728467803], [1.0454907631030363, 0.25417365789585644], [1.114823648264001, 0.27792899829256185], [1.0920236773904681, 0.26755292473439246], [1.0920236773904681, 0.26755292473439246], [1.1575745315998076, 0.30591170310628923], [1.1368024383462858, 0.29075112219533716], [1.1368024383462858, 0.29075112219533716], [1.114823648264001, 0.27792899829256185], [1.114823648264001, 0.27792899829256185], [1.1368024383462858, 0.29075112219533716], [1.0687895537113423, 0.2596502604532421], [1.0687895537113423, 0.2596502604532421], [1.0920236773904681, 0.26755292473439246], [1.1940882968937108, 0.3424254684001923], [1.176776695296637, 0.32322330470336313], [1.176776695296637, 0.32322330470336313], [1.2220710017074383, 0.3851763517359991], [1.209248877804663, 0.36319756165371464], [1.209248877804663, 0.36319756165371464], [1.1940882968937108, 0.3424254684001923], [1.1940882968937108, 0.3424254684001923], [1.209248877804663, 0.36319756165371464], [1.2403497395467578, 0.4312104462886577], [1.2324470752656076, 0.4079763226095317], [1.2324470752656076, 0.4079763226095317], [1.2489887271532196, 0.4775363905255739], [1.2458263421041438, 0.4545092368969638], [1.2458263421041438, 0.4545092368969638], [1.25, 0.5], [1.2489887271532196, 0.4775363905255739], [1.2489887271532196, 0.4775363905255739], [1.2403497395467578, 0.4312104462886577], [1.2403497395467578, 0.4312104462886577], [1.2458263421041438, 0.4545092368969638], [1.2220710017074383, 0.3851763517359991], [1.2220710017074383, 0.3851763517359991], [1.2324470752656076, 0.4079763226095317], [1.1575745315998076, 0.30591170310628923], [1.1575745315998076, 0.30591170310628923], [1.176776695296637, 0.32322330470336313], [0.9775363905255738, 0.2510112728467803], [0.9775363905255738, 0.2510112728467803], [1.0, 0.25], [0.7510112728467803, 0.4775363905255738], [0.75, 0.5], [0.75, 0.5]]
        
        

        current_result = embedded_iga_modeler.PrintParametricTriangulation()
        
        self.assertEqual(len(current_result), len(reference_results))

        for reference_result, current_result in zip(reference_results, current_result):
            self.assertAlmostEqual(reference_result, current_result)


if __name__ == '__main__':
    KratosUnittest.main()
